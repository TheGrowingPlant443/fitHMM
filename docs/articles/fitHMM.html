<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fitHMM">
<title>fitHMM • fitHMM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="fitHMM">
<meta property="og:description" content="fitHMM">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fitHMM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/fitHMM.html">Get started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-functions">Functions</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-functions">
    <h6 class="dropdown-header" data-toc-skip>Constructing Objects</h6>
    <a class="dropdown-item" href="../reference/HMM.html">HMM object</a>
    <a class="dropdown-item" href="../reference/xHMM.html">xHMM object</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Fitting Objects</h6>
    <a class="dropdown-item" href="../reference/HMM_EM.html">EM algorithm for HMM Object</a>
    <a class="dropdown-item" href="../reference/nlm_hmm.html">Numeric Estimation of HMM Object</a>
    <a class="dropdown-item" href="../reference/Nstate_HMM.html">Easy fitting HMM object to n states</a>
    <a class="dropdown-item" href="../reference/Stationary.html">Make HMM stationary</a>
    <a class="dropdown-item" href="../reference/ForwardBackwardAlgorithm.html">Forward-Backward Algorithm</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Model Checking and Decoding</h6>
    <a class="dropdown-item" href="../reference/AICBIC.html">AIC and BIC of HMM and xHMM Objects</a>
    <a class="dropdown-item" href="../reference/Nstates_AICBIC.html">AIC and BIC for n states of HMM</a>
    <a class="dropdown-item" href="../reference/Local_decoding.html">Local Decoding</a>
    <a class="dropdown-item" href="../reference/Local_decoding_with_scaling.html">Local Decoding with Scaling</a>
    <a class="dropdown-item" href="../reference/State_prediction.html">State Prediction</a>
    <a class="dropdown-item" href="../reference/Viterbi.html">Viterbi Algorithm</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Is functions</h6>
    <a class="dropdown-item" href="../reference/is.BernoullHMM.html">Is Bernoulli?</a>
    <a class="dropdown-item" href="../reference/is.HMM.html">Is HMM?</a>
    <a class="dropdown-item" href="../reference/is.NormalHMM.html">Is Normal?</a>
    <a class="dropdown-item" href="../reference/is.PoissonHMM.html">Is Poisson?</a>
    <a class="dropdown-item" href="../reference/is.xHMM.html">Is xHMM?</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>fitHMM</h1>
            
      
      
      <div class="d-none name"><code>fitHMM.Rmd</code></div>
    </div>

    
    
<div class="section level1">
<h1 id="section">
<img src="../../../../9.%20Semester/Advanced%20R%20programming/fitHMM/articles/logo.svg" align="right" height="139"><a class="anchor" aria-label="anchor" href="#section"></a>
</h1>
<div class="section level2">
<h2 id="hidden-markov-models">Hidden Markov Models<a class="anchor" aria-label="anchor" href="#hidden-markov-models"></a>
</h2>
<p>A hidden Markov model (HMM) is a simple and flexible model for data with serial dependence that consists of two parts, the observed sequence, which we will denote by <span class="math inline">\(X_1,\dots,X_T\)</span>, and the hidden sequence, which we will denote by <span class="math inline">\(C_1,\dots, C_T\)</span>. It is assumed that the hidden sequence constitutes a first order homogeneous Markov chain with finite state space <span class="math inline">\(\{1,\dots,m\}\)</span>, i.e. <span class="math display">\[
P(C_t = j\;\vert\;C_1 = i_1,\dots, C_{t-2}=i_{t-2}, C_{t-1} = i) = P(C_t=j\;\vert\; C_{t-1} = i) = \gamma_{ij},
\]</span> for any <span class="math inline">\(i,i_1,\dots,i_{t-1}\in\{1,\dots,m\}\)</span> and any <span class="math inline">\(t\in\{2,\dots,T\}\)</span>. The initial distribution of the Markov chain, i.e. the distribution of <span class="math inline">\(C_1\)</span>, is described by the initial probabilities: <span class="math display">\[
P(C_1 = i) = \delta_i,
\]</span> For any <span class="math inline">\(i\in\{1,\dots,m\}\)</span>.</p>
<p>Furthermore, we assume that <span class="math display">\[
P(X_t=x\;\vert\; X_1=x_1,\dots, X_{t-1}=x_{t-1}, C_1=i_1,\dots,C_{t-1}=i_{t-1}, C_t=i)
= P(X_1=x\;\vert\; C_t=i) = p_i(x),
\]</span> for any <span class="math inline">\(x_1,\dots,x_{t-1},x\)</span>, any <span class="math inline">\(i_1,\dots,i_{t-1},i\in\{1,\dots,m\}\)</span>, and any <span class="math inline">\(t\in\{1,\dots,T\}\)</span>.</p>
<p>This can be depicted with the following graph structure: <span class="math display">\[
\begin{matrix}
C_1 &amp; \rightarrow &amp; C_2 &amp; \rightarrow &amp; \cdots &amp; \rightarrow C_{T-1} &amp; \rightarrow &amp; C_T\\
\downarrow &amp; &amp; \downarrow &amp; &amp; &amp; \downarrow &amp; &amp; \downarrow \\
X_1 &amp; &amp; X_2 &amp; &amp; &amp; X_{T-1} &amp; &amp; X_T
\end{matrix}
\]</span></p>
<div class="section level3">
<h3 id="calculating-the-likelihood">Calculating the Likelihood<a class="anchor" aria-label="anchor" href="#calculating-the-likelihood"></a>
</h3>
<p>Due to the dependence structure of an HMM, the likelihood can be calculated as <span class="math display">\[
L(\theta) = \sum_{c_1=1}^m\cdots\sum_{c_T=1}^m\delta_{c_1}p_{c_1}(x_1)\prod_{t=2}^T(\gamma_{c_{t-1}c_t}p_{c_t}(x_t)).
\]</span> Despite having <span class="math inline">\(m^T\)</span>-terms, it is possible to calculate in a simpler way using the forward algorithm. This involves calculating the forward probabilities <span class="math display">\[
\alpha_t(i) = P(c_t=i,x_1,\dots,x_t),
\]</span> via the recursion <span class="math display">\[
\alpha_1(j) = \delta_jp_j(x_1), \quad\text{and}\quad
\alpha_{t+1}(j) = \sum_{i=1}^m \alpha_t(i)\gamma_{ij}p_j(x_{t+1}).
\]</span> The likelihood can then be calculated as <span class="math display">\[
L(\theta) = \sum_{i=1}^m\alpha_T(i).
\]</span></p>
</div>
<div class="section level3">
<h3 id="estimating-parameters">Estimating Parameters<a class="anchor" aria-label="anchor" href="#estimating-parameters"></a>
</h3>
<p>Once the likelihood can be evaluated, it is possible to estimate the parameters of the HMM, i.e. the transition probabilities, the initial distribution, and the parameters of the emission distributions. Note that the initial distribution is not straightforward to estimate, since we only have one data point available. Thus it is sometimes assumed that the hidden Markov chain starts in its stationary distribution.</p>
<p>In the package, two methods of estimation are used. The first and perhaps most simple approach is to use numerical maximization of the likelihood function to estimate the parameters. This approach yields approximate maximum likelihood estimates, but quality of the results can depend quite a bit on the initial values selected.</p>
<p>The second approach is to use the Expectation Maximization (EM) algorithm, which in general can be used to find approximate maximum likelihood estimates in missing data problems. This can be applied to an HMM by thinking of the hidden Markov chain as missing data. In the HMM set-up, the EM algorithm is also know as the Baum-Welch algorithm. The algorithm iteratively updates the parameter estimates in two steps until convergence is reached. First, initial parameter values <span class="math inline">\(\theta_0\)</span> are selected. Denote by <span class="math inline">\(\theta_t\)</span> the parameter estimates in the <span class="math inline">\(t\)</span>’th round of the algorithm. In the first step, called the E-step, of the <span class="math inline">\((t+1)\)</span>’th iteration, the expectation under <span class="math inline">\(\theta_t\)</span> of the log likelihood conditioned on the observed data is calculated, <span class="math display">\[
Q(\theta\vert\theta_t) = E_{\theta_t}[\log L(\theta\vert X,C)\vert X=x].
\]</span> In the second step, called the M-step, of the <span class="math inline">\((t+1)\)</span>’th iteration, we update the parameter estimates, <span class="math display">\[
\theta_{t+1} = \arg\max_{\theta}Q(\theta\vert\theta_t).
\]</span> Again, the results may vary depending on the choice of initial parameters.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-fithmm-package">The fitHMM Package<a class="anchor" aria-label="anchor" href="#the-fithmm-package"></a>
</h2>
<p>The <code>fitHMM</code> package is made to work with hidden Markov models, and can be used for e.g. fitting, decoding, forecasting, model checking, and more.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">fitHMM</span><span class="op">)</span></code></pre></div>
<p>The building blocks of <code>fitHMM</code> are the <code>HMM</code> and <code>xHMM</code> objects, which contain the specification and parameters of the HMM. They are used to specify initial parameters before fitting, and keep the approximate maximum likelihood functions after fitting.</p>
<p>The <code>HMM</code> class can be used for HMMs with Poisson, Bernoulli, or Normal emission distributions. EM estimation is supported.</p>
<p>The <code>xHMM</code> class is more flexible, but also requires slightly more user specification. It supports any emission distribution with parameters which either are real, positive or probabilities. Only numerical estimation is provided.</p>
<div class="section level3">
<h3 id="working-with-hmm-objects">Working with HMM Objects<a class="anchor" aria-label="anchor" href="#working-with-hmm-objects"></a>
</h3>
<p>As an example consider the <code>Poisson2State</code> data set, which is included in the package. It is simulated from a two-state Poisson distribution. Ignoring this, we would like to work with an HMM for this data, using the knowledge that we are working with unbounded count data, and thus will try a Poisson distribution for our HMM. Using the <code>HMM</code>-function, we construct a HMM containing some initial parameters.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">fitHMM</span><span class="fu">::</span><span class="va"><a href="../reference/Poisson2State.html">Poisson2State</a></span>
<span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">initial_hmm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/HMM.html">HMM</a></span><span class="op">(</span><span class="st">"Poisson"</span>,
              emis_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span>,
              initial_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span>,
              TPM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Using the EM-algorithm, we fit the parameters.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fitted_hmm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/HMM_EM.html">HMM_EM</a></span><span class="op">(</span><span class="va">initial_hmm</span>, <span class="va">x</span><span class="op">)</span>
<span class="va">fitted_hmm</span>
<span class="co">#&gt; ## Emission distribution: Poisson </span>
<span class="co">#&gt; ## Distribution Parameters for emission probability:  9.6837 19.63486 </span>
<span class="co">#&gt; ## Start Probability for the n-states:  2.264111e-28 1 </span>
<span class="co">#&gt; ## Number of hidden states:  2 </span>
<span class="co">#&gt; ## Class PoissonHMM HMM </span>
<span class="co">#&gt; ## Transition Probability Matrix </span>
<span class="co">#&gt;           [,1]      [,2]</span>
<span class="co">#&gt; [1,] 0.5948173 0.4051827</span>
<span class="co">#&gt; [2,] 0.2918468 0.7081532</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ## Probability to go from, 1 state to 1 state:  0.594817291346773 </span>
<span class="co">#&gt; ## Probability to go from, 2 state to 1 state:  0.291846759828578 </span>
<span class="co">#&gt; ## Probability to go from, 1 state to 2 state:  0.405182708653227 </span>
<span class="co">#&gt; ## Probability to go from, 2 state to 2 state:  0.708153240171422</span></code></pre></div>
<p>Note, that if the initial parameter guesses are way off, calling <code>HMM_EM</code> might give an error. If this happens, try again with other initial parameters.</p>
<p>When working with Poisson, Bernoulli, or Normal HMMs, the function <code>Nstate_HMM</code> can also be useful. It fits an HMM to the model without us having to provide initial parameter guesses.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Nstate_HMM.html">Nstate_HMM</a></span><span class="op">(</span><span class="st">"Poisson"</span>, <span class="va">x</span>, nstates <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; ## Emission distribution: Poisson </span>
<span class="co">#&gt; ## Distribution Parameters for emission probability:  9.683895 19.63505 </span>
<span class="co">#&gt; ## Start Probability for the n-states:  7.251213e-18 1 </span>
<span class="co">#&gt; ## Number of hidden states:  2 </span>
<span class="co">#&gt; ## Class PoissonHMM HMM </span>
<span class="co">#&gt; ## Transition Probability Matrix </span>
<span class="co">#&gt;           [,1]      [,2]</span>
<span class="co">#&gt; [1,] 0.5948279 0.4051721</span>
<span class="co">#&gt; [2,] 0.2918624 0.7081376</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ## Probability to go from, 1 state to 1 state:  0.594827917895526 </span>
<span class="co">#&gt; ## Probability to go from, 2 state to 1 state:  0.291862363670113 </span>
<span class="co">#&gt; ## Probability to go from, 1 state to 2 state:  0.405172082104474 </span>
<span class="co">#&gt; ## Probability to go from, 2 state to 2 state:  0.708137636329887</span></code></pre></div>
<p>Likewise, this can be used to fit a three-state Poisson HMM to the data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Nstate_HMM.html">Nstate_HMM</a></span><span class="op">(</span><span class="st">"Poisson"</span>, <span class="va">x</span>, nstates <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt; ## Emission distribution: Poisson </span>
<span class="co">#&gt; ## Distribution Parameters for emission probability:  9.702382 19.15283 19.81374 </span>
<span class="co">#&gt; ## Start Probability for the n-states:  0 1 0 </span>
<span class="co">#&gt; ## Number of hidden states:  3 </span>
<span class="co">#&gt; ## Class PoissonHMM HMM </span>
<span class="co">#&gt; ## Transition Probability Matrix </span>
<span class="co">#&gt;             [,1]         [,2]         [,3]</span>
<span class="co">#&gt; [1,] 0.598187931 7.647816e-02 3.253339e-01</span>
<span class="co">#&gt; [2,] 0.999985872 1.412743e-05 3.433706e-10</span>
<span class="co">#&gt; [3,] 0.005446525 3.054377e-01 6.891158e-01</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ## Probability to go from, 1 state to 1 state:  0.598187930753681 </span>
<span class="co">#&gt; ## Probability to go from, 2 state to 1 state:  0.9999858722316 </span>
<span class="co">#&gt; ## Probability to go from, 3 state to 1 state:  0.00544652490174731 </span>
<span class="co">#&gt; ## Probability to go from, 1 state to 2 state:  0.0764781598868855 </span>
<span class="co">#&gt; ## Probability to go from, 2 state to 2 state:  1.41274250296507e-05 </span>
<span class="co">#&gt; ## Probability to go from, 3 state to 2 state:  0.305437716773009 </span>
<span class="co">#&gt; ## Probability to go from, 1 state to 3 state:  0.325333909359433 </span>
<span class="co">#&gt; ## Probability to go from, 2 state to 3 state:  3.43370644967691e-10 </span>
<span class="co">#&gt; ## Probability to go from, 3 state to 3 state:  0.689115758325244</span></code></pre></div>
<p>In order to check which these Poisson HMMs fits the model best, we compare AIC and BIC for Poisson-HMMs with difference state space sizes. For Poisson emission distributions (or Bernoulli, Normal), a nice plot can be made using <code>Nstates_AICBIC</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Nstates_AICBIC.html">Nstates_AICBIC</a></span><span class="op">(</span><span class="st">"Poisson"</span>, <span class="va">x</span>, nstates <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="fitHMM_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<pre><code><span class="co">#&gt;   NoStates      AIC      BIC</span>
<span class="co">#&gt; 1        2 629.5371 639.9578</span>
<span class="co">#&gt; 2        3 638.9975 662.4441</span>
<span class="co">#&gt; 3        4 647.6202 689.3029</span>
<span class="co">#&gt; 4        5 655.9359 721.0652</span></code></pre>
<p>Both AIC and BIC clearly prefer a two-state model (which makes sense, since this is the true model). Due to this, we choose to work with a two-state Poisson model, <code>fitted_hmm</code>.</p>
<p>We can use Viterbi decoding to find the most probable sequence of hidden states that emitted the observed sequence <code>x</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">decode_global</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Viterbi.html">Viterbi</a></span><span class="op">(</span><span class="va">fitted_hmm</span>, <span class="va">x</span><span class="op">)</span>
<span class="va">decode_global</span>
<span class="co">#&gt;   [1] 2 1 1 1 2 1 2 2 2 2 2 1 2 2 2 1 1 1 1 1 1 1 2 2 2 2 2 1 1 2 2 2 1 1 2 1 1</span>
<span class="co">#&gt;  [38] 1 1 2 2 1 2 1 1 1 2 2 2 2 2 2 2 1 2 2 2 1 2 2 2 1 1 1 1 1 2 1 1 2 2 2 2 2</span>
<span class="co">#&gt;  [75] 2 2 2 2 1 1 2 2 2 2 2 2 2 1 2 2 2 1 2 2 2 1 1 2 2 2</span></code></pre></div>
<p>Using this, we can make the following plot, where the horizontal lines indicate the estimated rates: <img src="fitHMM_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>Alternatively, we can try local decoding. This can be done using the <code>Local_decoding</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">decode_local</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Local_decoding.html">Local_decoding</a></span><span class="op">(</span><span class="va">fitted_hmm</span>, <span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">Local_decoding_index</span>
<span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">decode_global</span> <span class="op">!=</span> <span class="va">decode_local</span><span class="op">)</span>
<span class="co">#&gt; [1] 61 78 84</span></code></pre></div>
<p>We see that the two decodings generally concur, except at three time points.</p>
</div>
<div class="section level3">
<h3 id="working-with-xhmm-objects">Working with xHMM Objects<a class="anchor" aria-label="anchor" href="#working-with-xhmm-objects"></a>
</h3>
<p>Like for the HMM objects consider an included data set of the package, this one called <code>Nbinom2State</code>, which has been simulated from a two-state negative binomial distribution. Using the <code>xHMM</code> function an initial model is specified by setting the distribution as a function and specifying the domains of the parameters in <code>emis_paramspace</code>, otherwise the parameters are specified as before.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x_nbinom</span> <span class="op">&lt;-</span> <span class="fu">fitHMM</span><span class="fu">::</span><span class="va"><a href="../reference/Nbinom2State.html">Nbinom2State</a></span>
<span class="va">initial_xhmm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xHMM.html">xHMM</a></span><span class="op">(</span><span class="va">dnbinom</span>,
                    emis_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span><span class="op">)</span>,
                    emis_paramspace <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="st">"pos_real"</span>, prob<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
                    initial_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span>,
                    TPM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">initial_xhmm</span>
<span class="co">#&gt; ## Emission distribution: </span>
<span class="co">#&gt; ## Distribution Parameters for emission probability:  20 30 0.5 0.5 </span>
<span class="co">#&gt; ## Start Probability for the n-states:  0.1 0.9 </span>
<span class="co">#&gt; ## Number of hidden states:  2 </span>
<span class="co">#&gt; ## The value set of Distribution Parameters :  pos_real prob </span>
<span class="co">#&gt; ## Class xHMM </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ## Transition Probability Matrix </span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]  0.5  0.5</span>
<span class="co">#&gt; [2,]  0.5  0.5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ## Probability to go from, 1 state to 1 state:  0.5 </span>
<span class="co">#&gt; ## Probability to go from, 2 state to 1 state:  0.5 </span>
<span class="co">#&gt; ## Probability to go from, 1 state to 2 state:  0.5 </span>
<span class="co">#&gt; ## Probability to go from, 2 state to 2 state:  0.5</span></code></pre></div>
<p>Using the nonlinear maximization algorithm <code>nlm_hmm</code> the parameters can be fitted. (remark <code>suppressWarnings</code> is called on the function here, to make the output more readable)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fitted_xhmm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="../reference/nlm_hmm.html">nlm_hmm</a></span><span class="op">(</span><span class="va">initial_xhmm</span>, <span class="va">x_nbinom</span><span class="op">)</span><span class="op">)</span>
<span class="va">fitted_xhmm</span>
<span class="co">#&gt; ## Emission distribution: </span>
<span class="co">#&gt; ## Distribution Parameters for emission probability:  10.71986 91.21169 0.2426227 0.2775183 </span>
<span class="co">#&gt; ## Start Probability for the n-states:  2.074865e-07 0.9999998 </span>
<span class="co">#&gt; ## Number of hidden states:  2 </span>
<span class="co">#&gt; ## The value set of Distribution Parameters :  pos_real prob </span>
<span class="co">#&gt; ## Class xHMM </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ## Transition Probability Matrix </span>
<span class="co">#&gt;           [,1]      [,2]</span>
<span class="co">#&gt; [1,] 0.6341469 0.3658531</span>
<span class="co">#&gt; [2,] 0.2586202 0.7413798</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ## Probability to go from, 1 state to 1 state:  0.634146888264777 </span>
<span class="co">#&gt; ## Probability to go from, 2 state to 1 state:  0.258620196686465 </span>
<span class="co">#&gt; ## Probability to go from, 1 state to 2 state:  0.365853111735222 </span>
<span class="co">#&gt; ## Probability to go from, 2 state to 2 state:  0.741379803313535</span></code></pre></div>
<p>For <code>xHMM</code> objects the fit of the model can be checked using the function <code>AICBIC</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/AICBIC.html">AICBIC</a></span><span class="op">(</span><span class="va">fitted_xhmm</span>, <span class="va">x_nbinom</span><span class="op">)</span>
<span class="co">#&gt; $AIC</span>
<span class="co">#&gt; [1] 1012.783</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $BIC</span>
<span class="co">#&gt; [1] 1028.415</span></code></pre></div>
<p>Remark that the decoding functions <code>Viterbi</code> and <code>Local_decoding</code> work exactly like in the case for the <code>HMM</code> object.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Pi Vejsig Madsen, Martin Christian Brodersen, Thomas Kuhlwein.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.0.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
